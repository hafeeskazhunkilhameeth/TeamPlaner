{% extends "templates/web.html" %}

{% block title %}{{ _("Anwesenheitskontrolle") }}{% endblock %}
{% block header %}<h1>{{ _("Anwesenheitskontrolle") }}</h1>{% endblock %}

{% block page_sidebar %}
{% include "templates/pages/web_sidebar.html" %}
{% endblock %}

{% block page_content %}
<div class="jumbotron">
	<center><p><strong>Achtung (<i class="fa fa-dollar"></i>):</strong> wenn Du einen ursprünglich angemeldeten Spieler abmeldest, hast Du die Möglichkeit zur Auswahl der Funktion "Mit Busse", dadurch wird eine Busse gegen diesen Spieler ausgelöst! Ausgelöste Bussen können nur via Backend zurückgezogen werden!</p></center><br>
</div>
<div class="panel-group" id="accordion_kurz">
{% for training in trainings_kurz %}
	{% set stundensperre = frappe.utils.date_diff(training.name, frappe.utils.now()) %}
	<div class="panel panel-default">
		<div class="panel-heading">
		  <h4 class="panel-title">
			<a data-toggle="collapse" data-parent="#accordion_kurz" href="#{{ training.name }}">
			{{ training.beschriftung }} ({{ teilnehmer[training.name] }})</a>
		  </h4>
		</div>
		<div id="{{ training.name }}" class="panel-collapse collapse">
		  <div class="panel-body">
			<table style="width: 100%">
				<tr>
					<td><i class="fa fa-bell"></i> von {{ training.von }} bis {{ training.bis }}<br>&nbsp;<i class="fa fa-map-marker"></i> {{ training.ort or 'Keine Angabe' }}</td>
				</tr>
			</table>
			<h4>Teilnehmer</h4>
			<table style="width: 100%; cursor: pointer;">
				{% for sp in spieler[training.name] %}
				<tr id="{{ training.name }}-{{ sp[3] }}" style="{% if sp[2] == 'Anwesend' %}background-color: #50D050;{% else %}background-color: red;{% endif %}">
					<td style="width: 10%; height: 30px;">&nbsp;<i class="fa fa-exchange"></i>{% if stundensperre < 1 %}&nbsp;<i class="fa fa-dollar"></i>{% endif %}</td>
					<td style="width 10%; height: 30px;">
						<label class="switch">
							<input type="checkbox" {% if stundensperre < 1 %}{% if sp[2] == 'Anwesend' %} checked onclick="abfrage('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% else %}onclick="anwesend_ohne_busse('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% endif %}{% else %}{% if sp[2] == 'Anwesend' %} checked {% endif %}onclick="change_anwesenheit('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% endif %}>
							<span class="slider round"></span>
						</label>
					</td>
					<td style="width 80%; height: 30px;">{{ sp[0] }} {{ sp[1] }}</td>
				</tr>
				{% endfor %}
			</table>
		  </div>
		</div>
	 </div>
{% endfor %}
</div> 

<button type="button" class="btn btn-primary btn-block" onclick="alle_trainings_laden();" id="show_all_btn">Alle Trainings laden</button>

<div class="panel-group hidden" id="accordion">
{% for training in trainings %}
	{% set stundensperre = frappe.utils.date_diff(training.name, frappe.utils.now()) %}
	<div class="panel panel-default">
		<div class="panel-heading">
		  <h4 class="panel-title">
			<a data-toggle="collapse" data-parent="#accordion" href="#{{ training.name }}">
			{{ training.beschriftung }} ({{ teilnehmer[training.name] }})</a>
		  </h4>
		</div>
		<div id="{{ training.name }}" class="panel-collapse collapse">
		  <div class="panel-body">
			<table style="width: 100%">
				<tr>
					<td><i class="fa fa-bell"></i> von {{ training.von }} bis {{ training.bis }}<br>&nbsp;<i class="fa fa-map-marker"></i> {{ training.ort or 'Keine Angabe' }}</td>
				</tr>
			</table>
			<h4>Teilnehmer</h4>
			<table style="width: 100%">
				{% for sp in spieler[training.name] %}
				<tr id="{{ training.name }}-{{ sp[3] }}" {% if stundensperre < 1 %}{% if sp[2] == 'Anwesend' %}onclick="abfrage('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% else %}onclick="anwesend_ohne_busse('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% endif %}{% else %}onclick="change_anwesenheit('{{ training.name }}', '{{ sp[3] }}', '{{ sp[2] }}', '{{ training.name }}-{{ sp[3] }}');" {% endif %}style="{% if sp[2] == 'Anwesend' %}background-color: #50D050;{% else %}background-color: red;{% endif %}">
					<td style="width: 10%; height: 30px;">&nbsp;<i class="fa fa-exchange"></i>{% if stundensperre < 1 %}&nbsp;<i class="fa fa-dollar"></i>{% endif %}</td>
					<td style="width 90%; height: 30px;">{{ sp[0] }} {{ sp[1] }}</td>
				</tr>
				{% endfor %}
			</table>
		  </div>
		</div>
	 </div>
{% endfor %}
</div> 
{% endblock %}



